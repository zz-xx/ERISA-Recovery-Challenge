{% load claim_tags %}

{# The ID on this figure is the new target for all HTMX swaps #}
<figure id="claims-table-wrapper">
    <table role="grid">
        <colgroup>
            <col class="claim-id-col">
            <col class="patient-col">
            <col class="billed-col">
            <col class="paid-col">
            <col class="status-col">
            <col class="insurer-col">
            <col class="discharge-col">
            <col class="actions-col">
        </colgroup>
        <thead>
            <tr>
                <th scope="col">
                    {# This link will now be correctly re-rendered on every sort/filter action #}
                    <a class="sort-link" style="cursor: pointer; white-space: nowrap;" hx-get="{% sort_url 'id' %}"
                        hx-target="#claims-table-wrapper" hx-push-url="true">
                        Claim ID {% sort_indicator 'id' %}
                    </a>
                </th>
                
                {# === PATIENT SORTABLE === #}
                <th scope="col">
                    <a class="sort-link" style="cursor: pointer; white-space: nowrap;"
                hx-get="{% sort_url 'patient_name' %}" 
                hx-target="#claims-table-wrapper" 
                hx-push-url="true">
                Patient {% sort_indicator 'patient_name' %}
                    </a>
                </th>

                {# === BILLED SORTABLE === #}
                <th scope="col">
                    <a class="sort-link" style="cursor: pointer; white-space: nowrap;"
                hx-get="{% sort_url 'billed_amount' %}" 
                hx-target="#claims-table-wrapper" 
                hx-push-url="true">
                Billed {% sort_indicator 'billed_amount' %}
                    </a>
                </th>

                {# === PAID SORTABLE === #}
                <th scope="col">
                    <a class="sort-link" style="cursor: pointer; white-space: nowrap;"
                hx-get="{% sort_url 'paid_amount' %}" 
                hx-target="#claims-table-wrapper" 
                hx-push-url="true">
                Paid {% sort_indicator 'paid_amount' %}
                    </a>
                </th>

                <th scope="col">Status</th>
                
                {# === INSURER SORTABLE === #}
                <th scope="col">
                    <a class="sort-link" style="cursor: pointer; white-space: nowrap;"
                hx-get="{% sort_url 'insurer_name' %}" 
                hx-target="#claims-table-wrapper" 
                hx-push-url="true">
                Insurer {% sort_indicator 'insurer_name' %}
                    </a>
                </th>

                {# === DISCHARGE DATE SORTABLE === #}
                <th scope="col">
                    <a class="sort-link" style="cursor: pointer; white-space: nowrap;"
                hx-get="{% sort_url 'discharge_date' %}" 
                hx-target="#claims-table-wrapper" 
                hx-push-url="true">
                Discharge Date {% sort_indicator 'discharge_date' %}
                    </a>
                </th>

                <th scope="col">Actions</th>
            </tr>
        </thead>
        <tbody id="claims-tbody">
            {% include 'claims/partials/_claim_rows.html' %}
        </tbody>
    </table>
</figure>