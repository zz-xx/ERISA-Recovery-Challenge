{% load humanize %}

{% for claim in claims %}
<tr>
    <td class="claim-id-link">
        {{ claim.id }}
    </td>
    <td>
        <strong>{{ claim.patient_name }}</strong>
    </td>
    <td>
        ${{ claim.billed_amount|floatformat:2|intcomma }}
    </td>
    <td class="{% if claim.status|slugify == 'denied' %}text-danger{% elif claim.status|slugify == 'paid' or claim.status|slugify == 'under-review' %}text-success{% endif %}">
        ${{ claim.paid_amount|floatformat:2|intcomma }}
    </td>
    <td>
        <span class="status-badge status-{{ claim.status|slugify }}">{{ claim.get_status_display }}</span>
    </td>
    <td>{{ claim.insurer_name }}</td>
    <td>{{ claim.discharge_date }}</td>
    
    <td>
        <div>
            
            <button class="action-btn js-view-details-btn" title="View Details"
                hx-get="{% url 'claims:claim-detail' claim.id %}" hx-target="closest tr" hx-swap="afterend">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
            </button>

            {% include 'claims/partials/_flag_button.html' %}

        </div>
    </td>
</tr>
{% empty %}
<tr>
    <td colspan="8">
        <p>No claims found matching your criteria.</p>
    </td>
</tr>
{% endfor %}

{# Infinite scroll trigger #}

{% if page_obj.has_next %}
{# Add the _partial=rows parameter to the hx-get URL #}
<tr hx-get="?page={{ page_obj.next_page_number }}&sort={{ current_sort_param }}&search={{ current_search }}&status={{ current_status }}&flagged={{ current_flagged }}&_partial=rows"
    hx-trigger="revealed" hx-swap="outerHTML">
    <td colspan="8" >Loading more claims...</td>
</tr>

{% endif %}
