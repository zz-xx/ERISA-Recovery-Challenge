{% extends "base.html" %}
{% load claim_tags %}

{% block title %}Claims List{% endblock %}
{% block content %}
    <header>
        <h1>All Claims</h1>
    </header>
    
    <form 
        hx-get="{% url 'claims:claim-list' %}"
        hx-trigger="change from:select, keyup changed delay:300ms from:input[type='search'], change from:#flagged-filter"
        hx-target="#claims-table-wrapper"
        hx-push-url="true">

        <input type="hidden" name="sort" value="{{ request.GET.sort|default:'id' }}">

        <div class="filter-container">
            
            <div class="search-field">
                <input type="search" name="search" placeholder="Search by Patient or Insurer..." value="{{ current_search }}">
            </div>

            <div class="controls">
                <div class="status-select-wrapper">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                    </svg>
                    <select name="status">
                        <option value="">All Statuses</option>
                        {% for value, label in claim_statuses %}
                        <option value="{{ value }}" {% if value == current_status %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div>
                    <input type="checkbox" id="flagged-filter" name="flagged" value="true" {% if current_flagged == 'true' %}checked{% endif %}>
                    <label for="flagged-filter" role="button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path>
                            <line x1="4" y1="22" x2="4" y2="15"></line>
                        </svg>
                        View Flagged
                    </label>
                </div>
            </div>
        </div>
    </form>
    
    {% include "claims/partials/_claims_table.html" %}

{% endblock %}