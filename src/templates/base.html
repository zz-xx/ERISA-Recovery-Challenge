{% load static %}
<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ERISA Recovery Claims{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Fira Sans + Fira Mono -->
    <link
        href="https://fonts.googleapis.com/css2?family=Fira+Sans:ital,wght@0,100..900;1,100..900&family=Fira+Mono:wght@400;500;700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.slate.min.css" />

    <link rel="stylesheet" href="{% static 'css/style.css' %}">

</head>

<body>
    <main class="container">
        {% if user.is_authenticated %}
        <nav>
            <ul>
                <li>
                    <h2><a href="/">Claims Management System</a></h2>
                </li>
            </ul>
            <ul>

                <li>Hi, <strong>{{ user.username }}</strong></li>

                <li class="nav-actions">
                    <form action="{% url 'logout' %}" method="post">
                        {% csrf_token %}
                        <button type="submit" class="contrast logout-btn">Logout</button>
                    </form>

                    <button x-data="{ theme: document.documentElement.dataset.theme || 'light' }"
                        @click="theme = (theme === 'light' ? 'dark' : 'light'); document.documentElement.dataset.theme = theme"
                        class="secondary outline theme-toggle-btn" title="Toggle theme">
                        <svg x-show="theme === 'dark'" style="display: none;" xmlns="http://www.w3.org/2000/svg"
                            width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>

                        <svg x-show="theme === 'light'" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                    </button>

                </li>

            </ul>
        </nav>
        {% endif %}
        {% block content %}{% endblock %}
    </main>

    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <script>

        // standard Django-recommended script to get the CSRF token from cookies
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        const csrftoken = getCookie('csrftoken');

        // Add the token to all HTMX POST, PUT, DELETE requests
        document.body.addEventListener('htmx:configRequest', (event) => {
            if (!['get', 'head', 'options', 'trace'].includes(event.detail.verb)) {
                event.detail.headers['X-CSRFToken'] = csrftoken;
            }
        });

        // script to handle detail view toggling
        document.body.addEventListener('htmx:beforeRequest', function (event) {
            const trigger = event.detail.elt;
            if (trigger.classList.contains('js-view-details-btn')) {
                const dataRow = trigger.closest('tr');
                const nextRow = dataRow.nextElementSibling;
                if (nextRow && nextRow.classList.contains('inserted-detail-row')) {
                    nextRow.remove();
                    event.preventDefault();
                }
            }
        });
    </script>
</body>

</html>
